<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script type="text/javascript" src="src/index.js" ></script>
    <script type="text/javascript" src="src/Constants.js" ></script>
    <script type="text/javascript" src="src/Mappers.js" ></script>
    <script type="text/javascript" src="src/PPU.js" ></script>
    <title></title>
  </head>
  <body>
    <canvas id="mycanvas" width="256" height="240"
              style="width:30rem; height:30rem;"></canvas>
  </body>
  <script type="text/javascript">
    var cxt = document.querySelector('#mycanvas').getContext('2d');
    var nes = new NES();

    fetch('http://localhost:3000/roms/test.nes',
    { headers: {
       'Content-Type': 'image/jpeg'
    }})
    .then((response) => {
      response.arrayBuffer().then(function(buffer) {
        nes.init(buffer, cxt);

        var counter = Math.floor(341 * 262 / 3) * 6 + 27399;
        for(var i=0; i<counter ; i++) {
          nes.ppu.cycles = i;
          nes.run();
          nes.ppu.run();
          nes.ppu.run();
          nes.ppu.run();
        }

        nes.dumpCPU();
      });
    });
  </script>
</html>
